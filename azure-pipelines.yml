trigger:
  branches:
    include:
      - HMIS-152*

parameters:
  - name: environment
    displayName: Environment
    type: string
    default: 'sbox,test'

variables:
  - template: pipeline/variables-common.yaml
  - ${{ if eq(parameters.environment, 'sbox') }}:
    - template: pipeline/variables-sbox.yaml
  - ${{ if eq(parameters.environment, 'test') }}:
    - template: pipeline/variables-test.yaml
  
stages:
  - stage: terraform
    displayName: Terraform
    jobs:
    - template: pipeline/steps/20-tf-install.yml
      parameters:
        terraformVersion: ${{ variables.terraformVersion }}
    - template: pipeline/steps/21-tf-init.yml
      parameters:
        subscription: $(subscription)
        environment: $(environment)
        prefix: $(prefix)
        product: $(product)
        location: $(location)