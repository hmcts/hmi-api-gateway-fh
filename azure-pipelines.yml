trigger:

  - HMIS-152*
pr:
  - master
parameters:
  - name: environment
    displayName: Env
    type: string
    default: 'sbox'
    values:
      - sbox
      - test

variables:
  # - template: pipeline/variables-common.yaml
  - group: HMI-APIM-Common
  # - ${{ if eq(parameters.environment, 'sbox') }}:
  #   - template: pipeline/variables-sbox.yaml
  # - ${{ if eq(parameters.environment, 'test') }}:
  #   - template: pipeline/variables-test.yaml

stages:
  - stage: Terraform
    displayName: Terraform
    jobs:
    # - template: pipeline/steps/20-tf-install.yml
    #   parameters:
    #     terraformVersion: ${{ variables.terraformVersion }}
    # - template: pipeline/steps/21-tf-init.yml
    #   parameters:
    #     subscription: $(subscription)
    #     environment: $(environment)
    #     prefix: $(prefix)
    #     product: $(product)
    #     location: $(location)
      - job:
        steps:
          - task: Bash@3
            displayName: "Get Variable Groups"
            inputs:
              filePath: 'pipeline/scripts/get_variable_groups.sh'
              arguments: '$(devopsUserName), $(devopsAccessToken)'
              workingDirectory: '$(System.DefaultWorkingDirectory)/pipeline'
