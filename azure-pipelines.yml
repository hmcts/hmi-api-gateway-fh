trigger:

  - HMIS-152*
pr:
  - master
parameters:
  - name: environment
    displayName: Env
    type: string
    default: 'sbox'
    values:
      - sbox
      - test

variables:
  - group: HMI-APIM-Common
  - ${{ if eq(parameters.environment, 'sbox') }}:
    - group: HMI-APIM-Sbox
  - ${{ if eq(parameters.environment, 'test') }}:
    - group: HMI-APIM-Test

stages:
  - stage: prepare
    displayName: Read and update variable groups
    jobs:
    # - template: pipeline/steps/20-tf-install.yml
    #   parameters:
    #     terraformVersion: ${{ variables.terraformVersion }}
    # - template: pipeline/steps/21-tf-init.yml
    #   parameters:
    #     subscription: $(subscription)
    #     environment: $(environment)
    #     prefix: $(prefix)
    #     product: $(product)
    #     location: $(location)
      - job:
        steps:
          - task: Bash@3
            displayName: "Get Variable Groups"
            inputs:
              filePath: 'pipeline/variables/update_variable_groups.sh'
              arguments: '$(devopsUser), $(devopsPAT)'
              workingDirectory: '$(System.DefaultWorkingDirectory)/pipeline'
