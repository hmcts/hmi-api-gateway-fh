parameters:
  - name: secure_file
    type: string

steps:
- task: DownloadSecureFile@1
  displayName: 'Download secure file'
  inputs:
    secureFile: ${{ parameters.secure_file }}
- task: replacetokens@3
  displayName: Replace Tokens in Policy files
  inputs:
    targetFiles: '**/*-policy.xml'
    encoding: 'auto'
    writeBOM: true
    actionOnMissing: 'warn'
    keepToken: false
    tokenPrefix: '#{'
    tokenSuffix: '}#'
    useLegacyPattern: false
    variableFiles: 'pipeline/variables/policy-variables-$(environment).json'
    enableTelemetry: true
