parameters:
  - name: runCommand
    type: string

steps:
  - task: Gradle@2
    displayName: Run gradle
    inputs:
      gradleWrapperFile: 'gradlew'
      workingDirectory: '$(System.DefaultWorkingDirectory)'
      tasks: clean ${{ parameters.runCommand }}
      publishJUnitResults: true
      testResultsFiles: '**/TEST-*.xml'
      javaHomeOption: 'JDKVersion'
      jdkVersionOption: '1.11'
      sonarQubeRunAnalysis: false

  - task: ArchiveFiles@2
    displayName: Archive Serenity Results
    inputs:
      rootFolderOrFile: '$(System.DefaultWorkingDirectory)/target/site/serenity'
      archiveFile: '$(Build.ArtifactStagingDirectory)/$(Build.BuildId)-${{ parameters.runCommand }}.zip'
    condition: succeededOrFailed()

  - task: AzureFileCopy@4
    displayName: Publish Serenity Results
    inputs:
      SourcePath: '$(Build.ArtifactStagingDirectory)/$(Build.BuildId)-${{ parameters.runCommand }}.zip'
      azureSubscription: 'DTS-SHAREDSERVICES-SBOX'
      Destination: AzureBlob
      storage: hmiapimsboxsa
      ContainerName: test-results-08-24-20
    condition: succeededOrFailed()