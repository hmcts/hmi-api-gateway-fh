parameters:
  - name: subscription
    type: string

  - name: containerRegistry
    type: string

  - name: repository
    type: string
  
  - name: tags
    type: string

  - name: volumes
    type: string

  - name: testUrl
    type: string
    
  - name: securityRules
    type: string

steps:
# - task: Docker@1
#   displayName: Run an image
#   inputs:
#     containerregistrytype: Container Registry
#     dockerRegistryEndpoint: ${{ parameters.registry }}
#     command: Run an image
#     imageName: 'ssprivatesbox.azurecr.io/hmi/apim-tests-owasp:latest'
#     volumes: ${{ parameters.volumes }}
#     envVars: |
#      TEST_URL=${{ parameters.testUrl }}
#      SecurityRules=${{ parameters.securityRules }}
#     workingDirectory: $(System.DefaultWorkingDirectory)
#     containerCommand: /bin/bash ./security.sh
#     runInBackground: false

- task: Docker@1
  displayName: 'Run an image'
  inputs:
    azureSubscriptionEndpoint: ${{ parameters.subscription }}
    azureContainerRegistry: ${{ parameters.containerRegistry }}
    command: 'Run an image'
    imageName: ${{ parameters.containerRegistry }}${{ parameters.repository }}:${{ parameters.tags }}
    volumes: $(System.DefaultWorkingDirectory)${{ parameters.directory }}:/zap/wrk/:rw
    envVars: |         
      TEST_URL=${{ parameters.testUrl }}
      SecurityRules=${{ parameters.securityRules }}
    containerCommand: '/bin/bash ./security.sh'
    runInBackground: false