parameters:
  - name: subscription
    type: string

steps:

- task: TerraformCLI@0
  displayName: Terraform apply
  inputs:
    command: apply
    workingDirectory: $(System.DefaultWorkingDirectory)/infrastructure/terraform/
    environmentServiceName: ${{ parameters.subscription }}
    commandOptions: -auto-approve -state-out=$(environment).tfstate tfplan-$(environment)

- task: TerraformCLI@0
  displayName: Terraform output
  inputs:
    command: output
    workingDirectory: $(System.DefaultWorkingDirectory)/infrastructure/terraform/
    commandOptions: -state=$(environment).tfstate hmi_apim_gateway_url
