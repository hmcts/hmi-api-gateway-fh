parameters:
  - name: subscription
    type: string

steps:

- task: AzurePowerShell@5
  displayName: Replace Tokens
  inputs:
    azureSubscription: ${{ parameters.subscription }}
    ScriptType: 'FilePath'
    ScriptPath: '$(System.DefaultWorkingDirectory)/script/replace-token.ps1'
    errorActionPreference: 'continue'
    azurePowerShellVersion: 'LatestVersion'
    
- task: TerraformCLI@0
  displayName: Terraform apply
  inputs:
    command: apply
    workingDirectory: $(System.DefaultWorkingDirectory)/infrastructure/terraform/
    environmentServiceName: ${{ parameters.subscription }}
    commandOptions: -auto-approve tfplan-$(environment)
