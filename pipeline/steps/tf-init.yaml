steps:

  - task: TerraformCLI@0
    displayName: Terraform init
    inputs:
      command: init
      workingDirectory: $(System.DefaultWorkingDirectory)/infrastructure/terraform/
      backendType: azurerm
      backendServiceArm: $(subscription)
      backendAzureRmResourceGroupName: $(resourceGroup)
      backendAzureRmResourceGroupLocation: $(location)
      backendAzureRmStorageAccountName: $(storageAccount)
      backendAzureRmContainerName: $(prefix)$(product)terraform
      backendAzureRmKey: $(prefix)$(product).tfstate

  - task: TerraformCLI@0
    displayName: Terraform validate
    inputs:
      command: validate
      workingDirectory: $(System.DefaultWorkingDirectory)/infrastructure/terraform/